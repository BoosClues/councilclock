<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tiki Vampyr â€” The Council Convenes</title>
<style>
  :root{
    --ink:#0a0a0a;
    --bone:#e7dfcf;
    --crimson:#b11127;
    --ember:#ff914d;
    --accent:#a0834a;
  }
  html,body{height:100%; margin:0; background:var(--ink); color:var(--bone); font-family: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;}
  .stage{position:relative; height:100%; overflow:hidden; isolation:isolate; background:var(--ink);}  
  .bg{position:absolute; inset:0; background:url("./Tiki%20Far.jpg") center/cover no-repeat fixed; filter:saturate(0.88) contrast(1.1) brightness(0.85); transform:scale(1.02); animation: slowPan 60s linear infinite alternate; z-index:-3;}

  /* Close shot used for pan/zoom */
  .bg-close{position:absolute; inset:0; background:url("./Tiki%20Close%20up.png") center/cover no-repeat; opacity:0; transform:scale(1.05) translate3d(0,0,0); transition: transform 8s ease-in-out, opacity 1.8s ease-in; z-index:-2;}
  /* Final state: gentle zoom-in with slight upward drift to keep full totem framed */
  .bg-close.zoom{ opacity:1; transform:scale(1.15) translateY(-2%); }

  .vignette{position:absolute; inset:-10vmax; pointer-events:none; z-index:-1; background:radial-gradient(120vmax 90vmax at 50% 55%, transparent 0 55%, rgba(0,0,0,.6) 70%, rgba(0,0,0,.9) 100%), radial-gradient(70vmax 50vmax at 20% 10%, rgba(255,145,77,.05), transparent 60%), radial-gradient(60vmax 40vmax at 80% 95%, rgba(177,17,39,.07), transparent 60%); mix-blend-mode:multiply; animation: smokeDrift 46s ease-in-out infinite;}
  @keyframes slowPan{ to{ transform:scale(1.06) translateY(-1%);} }
  @keyframes smokeDrift{ 50%{ transform:translate3d(0,-1%,0) rotate(.2deg);} }

  header{position:absolute; top:2.5vmin; left:0; right:0; text-align:center; letter-spacing:.06em; text-shadow: 0 0 4px rgba(0,0,0,.6), 0 2px 0 rgba(0,0,0,.6), 0 0 40px rgba(255,145,77,.2);}  
  .eyebrow{ font-size: clamp(.75rem, 1.5vw, 1rem); color: #d1c7b6; opacity:.9; margin-top:.3rem; }
  h1{margin:.2rem 0 0; font-weight:700; font-size:clamp(1.25rem, 3.8vw, 2.6rem);}  

  .wrap{height:100%; display:grid; place-items:center; padding:6vmin 4vmin;}
  .panel{max-width: min(900px, 95vw); width:100%; background: linear-gradient(180deg, rgba(18,16,18,.7), rgba(10,10,10,.78)), repeating-linear-gradient(90deg, rgba(255,255,255,.03), rgba(255,255,255,.03) 1px, transparent 1px, transparent 2px); backdrop-filter: blur(3px) saturate(0.9); border: 1px solid rgba(160,131,74,.35); box-shadow: 0 0 60px rgba(177,17,39,.3), 0 20px 80px rgba(0,0,0,.6), inset 0 0 60px rgba(177,17,39,.15); border-radius: 22px; padding: clamp(18px, 4.5vmin, 42px); position:relative; transition: opacity .8s ease, transform .8s ease;}
  .panel.fade-out{ opacity:0; transform: translateY(6px) scale(.98); pointer-events:none; }

  .panel::after{content:""; position:absolute; inset:-2px; border-radius:inherit; pointer-events:none; background: linear-gradient(130deg, transparent 30%, rgba(255,255,255,.06) 45%, transparent 60%); mix-blend-mode:screen; filter: blur(1px); animation: sheen 7s ease-in-out infinite; opacity:.35;}
  @keyframes sheen{ 50%{ transform:translateX(3%);} }

  .label{display:block; text-align:center; font-variant: small-caps; opacity:.9; letter-spacing:.12em; margin-bottom:1.2rem; color:#cabfae}
  .clock{display:flex; justify-content:center; align-items:stretch; gap: clamp(16px, 3vmin, 26px); text-align:center;}
  .unit{min-width: clamp(110px, 20vmin, 220px); background: linear-gradient(180deg, rgba(42,58,47,.36), rgba(18,16,18,.36)); border:1px solid rgba(160,131,74,.4); border-radius:16px; padding: clamp(10px, 2vmin, 14px) clamp(12px, 2.4vmin, 18px); box-shadow: inset 0 -8px 16px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06); position:relative; overflow:hidden;}
  .value{font-size: clamp(52px, 12vw, 150px); line-height:1; font-weight:800; letter-spacing:.04em; text-shadow:-1px -1px 0 rgba(0,0,0,.6), 1px  1px 0 rgba(0,0,0,.6), 0 0 22px rgba(177,17,39,.55), 0 0 48px rgba(177,17,39,.25); color: var(--bone);}  
  .legend{ margin-top:.35rem; font-size: clamp(.7rem, 1.8vw, 1rem); letter-spacing:.18em; opacity:.85; color:#d8ccb8 }
  .sep{ align-self:center; font-size: clamp(28px, 6vw, 64px); opacity:.8; text-shadow:0 0 12px rgba(177,17,39,.4)}
  .footer{margin-top: clamp(14px, 2.2vmin, 20px); text-align:center; font-size: clamp(.75rem, 1.6vw, 1rem); color:#bfb19a; opacity:.9}
  .flicker{ animation:flicker 3.5s infinite;}
  @keyframes flicker{ 0%, 100%{opacity:.85} 82%{opacity:.2} 83%{opacity:.6} 84%{opacity:.1} 85%{opacity:.8} }
  .zero .panel{ box-shadow: 0 0 100px rgba(177,17,39,.6), inset 0 0 100px rgba(177,17,39,.25); border-color: rgba(177,17,39,.5)}

  /* unobtrusive helper if audio needs user gesture */
  .audio-help{ position:fixed; left:50%; transform:translateX(-50%); bottom:14px; font-size:.85rem; background:rgba(18,16,18,.78); border:1px solid rgba(160,131,74,.45); color:#e8dfd0; padding:8px 12px; border-radius:10px; opacity:.95; transition: opacity .3s ease; }
  .audio-help.hide{ opacity:0; pointer-events:none; }
</style>
</head>
<body>
<div class="stage" id="stage">
  <div class="bg" aria-hidden="true"></div>
  <div class="bg-close" id="bgClose" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>
  <header>
    <h1 id="title">The Council Convenes</h1>
    <div class="eyebrow" id="subtitle">at the bum-bum of a drum</div>
  </header>
  <main class="wrap">
    <section class="panel" id="panel" aria-live="polite" aria-atomic="true">
      <span class="label">Countdown to Meeting</span>
      <div class="clock">
        <div class="unit"><div class="value" id="hours">00</div><div class="legend">Hours</div></div>
        <div class="sep flicker">:</div>
        <div class="unit"><div class="value" id="minutes">00</div><div class="legend">Minutes</div></div>
        <div class="sep flicker">:</div>
        <div class="unit"><div class="value" id="seconds">00</div><div class="legend">Seconds</div></div>
      </div>
      <p class="footer" id="footer">Midnight draws nearâ€¦</p>
    </section>
  </main>
</div>

<!-- Heartbeat SFX (place this mp3 next to the HTML) -->
<audio id="hb" src="./heartbeat-01-brvhrtz-225058.mp3" preload="auto"></audio>
<div class="audio-help hide" id="audioHelp">ðŸ”Š Click to enable sound</div>

<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const pad = (n)=> String(n).padStart(2,'0');
  const qs = new URLSearchParams(location.search);
  const lsKey = 'tiki_vampyr_countdown_target';
  let targetISO = (qs.get('target')||'').trim();
  if(!targetISO && localStorage.getItem(lsKey)) targetISO = localStorage.getItem(lsKey);
  if(!targetISO){ const d = new Date(); d.setHours(d.getHours()+1,0,0,0); targetISO = d.toISOString(); }
  let target = new Date(targetISO);
  if(isNaN(target)){ target = new Date(Date.now() + 60*60*1000); } else { localStorage.setItem(lsKey, target.toISOString()); }

  const nodes = {
    h:$('#hours'), m:$('#minutes'), s:$('#seconds'),
    footer:$('#footer'), stage:$('#stage'), bgClose:$('#bgClose'), panel:$('#panel'),
    hb:$('#hb'), audioHelp:$('#audioHelp')
  };
  let zeroed = false;

  function formatRemaining(ms){
    const total = Math.max(0, Math.floor(ms/1000));
    const hours = Math.floor(total / 3600);
    const mins  = Math.floor((total % 3600) / 60);
    const secs  = total % 60;
    return {hours, mins, secs};
  }

  function update(){
    const now = new Date();
    const diff = target - now;
    const {hours, mins, secs} = formatRemaining(diff);
    nodes.h.textContent = pad(hours);
    nodes.m.textContent = pad(mins);
    nodes.s.textContent = pad(secs);
    if(diff <= 0 && !zeroed){
      zeroed = true;
      nodes.stage.classList.add('zero');
      nodes.footer.textContent = 'The Council Begins';
      clearInterval(timer);
      finale();
    }
  }

  // Play heartbeat while the 8s pan/zoom runs, fade out the timer UI at the start
  function finale(){
    // fade out clock panel immediately
    nodes.panel.classList.add('fade-out');

    // start the pan/zoom (8s as defined in CSS)
    requestAnimationFrame(()=> nodes.bgClose.classList.add('zoom'));

    // try to play audio; if blocked by autoplay policy, show helper
    const tryPlay = () => nodes.hb.play().catch(() => {
      nodes.audioHelp.classList.remove('hide');
      const enable = () => {
        nodes.hb.play().finally(()=> nodes.audioHelp.classList.add('hide'));
        window.removeEventListener('pointerdown', enable);
      };
      window.addEventListener('pointerdown', enable);
    });

    // ensure we reset to start and stop when zoom ends (~8s)
    nodes.hb.currentTime = 0;
    nodes.hb.loop = true; // loop in case the file is shorter than 8s
    tryPlay();

    // stop sound when transition completes
    nodes.bgClose.addEventListener('transitionend', (e)=>{
      if(e.propertyName === 'transform'){
        nodes.hb.loop = false;
        nodes.hb.pause();
        nodes.hb.currentTime = 0;
      }
    }, { once:true });
  }

  const timer = setInterval(update, 200);
  update();
})();
</script>
</body>
</html>
