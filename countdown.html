<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tiki Vampyr — First Council Countdown</title>
<style>
  :root{
    --ink:#0a0a0a;      /* near-black */
    --soot:#121012;     /* deep soot */
    --bone:#e7dfcf;     /* aged parchment */
    --rust:#6a2a2a;     /* dried blood */
    --crimson:#b11127;  /* fresh blood */
    --ember:#ff914d;    /* ember glow */
    --moss:#2a3a2f;     /* swamp green */
    --accent:#a0834a;   /* tarnished gold */
  }
  html,body{height:100%; margin:0; background:var(--ink); color:var(--bone); font-family: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;}
  /* Root stage */
  .stage{
    position:relative; height:100%; overflow:hidden; isolation:isolate; background:var(--ink);
  }
  /* Background image: Tiki Far */
  .bg{
    position:absolute; inset:0; background:url("./Tiki%20Far.jpg") center/cover no-repeat fixed; filter:saturate(0.88) contrast(1.1) brightness(0.85);
    transform:scale(1.02);
    animation: slowPan 60s linear infinite alternate;
    z-index:-3;
  }
  /* Optional secondary image (for future zoom/eyes). Kept hidden for now. */
  .bg-close{
    position:absolute; inset:0; background:url("./Tiki%20Close%20up.png") center/cover no-repeat; opacity:0; pointer-events:none; z-index:-2;
  }
  /* Gothic vignette and smoke */
  .vignette{
    position:absolute; inset:-10vmax; pointer-events:none; z-index:-1;
    background:
      radial-gradient(120vmax 90vmax at 50% 55%, transparent 0 55%, rgba(0,0,0,.6) 70%, rgba(0,0,0,.9) 100%),
      radial-gradient(70vmax 50vmax at 20% 10%, rgba(255,145,77,.05), transparent 60%),
      radial-gradient(60vmax 40vmax at 80% 95%, rgba(177,17,39,.07), transparent 60%);
    mix-blend-mode:multiply;
    animation: smokeDrift 46s ease-in-out infinite;
  }
  @keyframes slowPan{ to{ transform:scale(1.06) translateY(-1%);} }
  @keyframes smokeDrift{ 50%{ transform:translate3d(0,-1%,0) rotate(.2deg);} }

  /* Ornate corners */
  .filigree::before,
  .filigree::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:
      radial-gradient(30px 30px at left top, rgba(160,131,74,.35), transparent 60%),
      radial-gradient(30px 30px at right top, rgba(160,131,74,.35), transparent 60%),
      radial-gradient(30px 30px at left bottom, rgba(160,131,74,.35), transparent 60%),
      radial-gradient(30px 30px at right bottom, rgba(160,131,74,.35), transparent 60%);
    mask:
      linear-gradient(#000, #000) top/100% 2px no-repeat,
      linear-gradient(#000, #000) bottom/100% 2px no-repeat,
      linear-gradient(#000, #000) left/2px 100% no-repeat,
      linear-gradient(#000, #000) right/2px 100% no-repeat;
    opacity:.55;
  }

  /* Header */
  header{
    position:absolute; top:2.5vmin; left:0; right:0; text-align:center; letter-spacing:.06em;
    text-shadow: 0 0 4px rgba(0,0,0,.6), 0 2px 0 rgba(0,0,0,.6), 0 0 40px rgba(255,145,77,.2);
  }
  .eyebrow{ font-size: clamp(.75rem, 1.5vw, 1rem); color: #d1c7b6; opacity:.9 }
  h1{
    margin:.2rem 0 0; font-weight:700; font-size:clamp(1.25rem, 3.8vw, 2.6rem);
  }

  /* Countdown panel */
  .wrap{
    height:100%; display:grid; place-items:center; padding:6vmin 4vmin;
  }
  .panel{
    max-width: min(1100px, 95vw);
    width:100%;
    background: linear-gradient(180deg, rgba(18,16,18,.7), rgba(10,10,10,.78)),
                repeating-linear-gradient(90deg, rgba(255,255,255,.03), rgba(255,255,255,.03) 1px, transparent 1px, transparent 2px);
    backdrop-filter: blur(3px) saturate(0.9);
    border: 1px solid rgba(160,131,74,.35);
    box-shadow: 0 20px 80px rgba(0,0,0,.6), inset 0 0 40px rgba(0,0,0,.35);
    border-radius: 22px;
    padding: clamp(20px, 4.5vmin, 48px);
    position:relative;
  }
  /* subtle moving sheen */
  .panel::after{
    content:""; position:absolute; inset:-2px; border-radius:inherit; pointer-events:none;
    background: linear-gradient(130deg, transparent 30%, rgba(255,255,255,.06) 45%, transparent 60%);
    mix-blend-mode:screen; filter: blur(1px);
    animation: sheen 7s ease-in-out infinite;
    opacity:.35;
  }
  @keyframes sheen{ 50%{ transform:translateX(3%);} }

  .label{
    display:block; text-align:center; font-variant: small-caps; opacity:.9; letter-spacing:.12em; margin-bottom:1.2rem; color:#cabfae
  }

  .clock{
    display:flex; justify-content:center; align-items:stretch; gap: clamp(14px, 2.6vmin, 24px);
    text-align:center;
  }
  .unit{
    min-width: clamp(90px, 16vmin, 180px);
    background: linear-gradient(180deg, rgba(42,58,47,.36), rgba(18,16,18,.36));
    border:1px solid rgba(160,131,74,.4);
    border-radius:16px; padding: clamp(10px, 2vmin, 14px) clamp(12px, 2.4vmin, 18px);
    box-shadow: inset 0 -8px 16px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    position:relative; overflow:hidden;
  }
  .unit::before{
    content:""; position:absolute; inset:0; background:
      radial-gradient(30% 60% at 50% 0%, rgba(255,145,77,.08), transparent 60%);
    pointer-events:none;
  }

  .value{
    font-size: clamp(42px, 9vw, 120px);
    line-height:1; font-weight:800; letter-spacing:.04em;
    text-shadow:
      -1px -1px 0 rgba(0,0,0,.6),
       1px  1px 0 rgba(0,0,0,.6),
       0 0 22px rgba(177,17,39,.55),
       0 0 48px rgba(177,17,39,.25);
    color: var(--bone);
  }
  .value .pulse{ color: var(--crimson); filter: drop-shadow(0 0 6px rgba(177,17,39,.6));}

  .legend{ margin-top:.35rem; font-size: clamp(.65rem, 1.5vw, .95rem); letter-spacing:.18em; opacity:.85; color:#d8ccb8 }

  .sep{ align-self:center; font-size: clamp(24px, 4.6vw, 52px); opacity:.8; text-shadow:0 0 12px rgba(177,17,39,.4)}

  .footer{
    margin-top: clamp(14px, 2.2vmin, 20px); text-align:center; font-size: clamp(.7rem, 1.6vw, .95rem); color:#bfb19a; opacity:.9
  }

  /* Flicker effect on colon */
  @keyframes flicker{ 0%, 100%{opacity:.85} 82%{opacity:.2} 83%{opacity:.6} 84%{opacity:.1} 85%{opacity:.8} }
  .flicker{ animation:flicker 3.5s infinite;}

  /* Finale state styles (at zero) */
  .zero .panel{ box-shadow: 0 30px 120px rgba(177,17,39,.45), inset 0 0 60px rgba(177,17,39,.2); border-color: rgba(177,17,39,.5)}
  .zero .value{ color: var(--crimson); text-shadow: 0 0 16px rgba(177,17,39,.8), 0 0 48px rgba(177,17,39,.5)}
  .zero .bg{ filter:saturate(1.05) contrast(1.2) brightness(0.9); animation-duration: 22s;}
  .zero .vignette{ animation-duration: 24s; }

  /* Helper badge */
  .help{
    position: fixed; right: 12px; bottom: 10px; background: rgba(18,16,18,.7); border:1px solid rgba(160,131,74,.45);
    color:#d9cdb8; border-radius: 10px; padding:8px 10px; font-size:.8rem; opacity:.85
  }
  .help kbd{ background:#241f1f; border:1px solid #4a3a3a; border-bottom-width:2px; padding:1px 6px; border-radius:6px; font-weight:700; color:#f0e8dc }

  /* Accessibility hidden text */
  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>
</head>
<body>
<div class="stage filigree" id="stage">
  <div class="bg" aria-hidden="true"></div>
  <div class="bg-close" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>

  <header>
    <div class="eyebrow" id="subtitle">The First Council Convenes</div>
    <h1 id="title">When the Bell Tolls</h1>
  </header>

  <main class="wrap">
    <section class="panel" aria-live="polite" aria-atomic="true">
      <span class="label">Countdown to Meeting</span>
      <div class="clock" role="timer" aria-describedby="a11y-remaining">
        <div class="unit"><div class="value" id="days">00</div><div class="legend">Days</div></div>
        <div class="sep flicker">:</div>
        <div class="unit"><div class="value" id="hours">00</div><div class="legend">Hours</div></div>
        <div class="sep flicker">:</div>
        <div class="unit"><div class="value" id="minutes">00</div><div class="legend">Minutes</div></div>
        <div class="sep flicker">:</div>
        <div class="unit"><div class="value" id="seconds">00</div><div class="legend">Seconds</div></div>
      </div>
      <p class="footer" id="footer">Midnight draws near…</p>
      <span id="a11y-remaining" class="sr-only">Time remaining</span>
    </section>
  </main>
</div>

<div class="help">Set target via URL, e.g. <kbd>?target=2025-10-31T21:00:00-04:00</kbd> · <kbd>title</kbd> · <kbd>subtitle</kbd></div>

<script>
(function(){
  // --- Utilities
  const $ = (s)=>document.querySelector(s);
  const pad = (n)=> String(n).padStart(2,'0');
  const qs = new URLSearchParams(location.search);
  const lsKey = 'tiki_vampyr_countdown_target';

  // --- Configure target time
  // Priority: URL ?target=ISO8601 -> localStorage -> default (now + 1 hour)
  let targetISO = (qs.get('target')||'').trim();
  if(!targetISO && localStorage.getItem(lsKey)) targetISO = localStorage.getItem(lsKey);
  if(!targetISO){
    const d = new Date(); d.setHours(d.getHours()+1, 0, 0, 0); // top of next hour
    targetISO = d.toISOString();
  }
  let target = new Date(targetISO);
  if(isNaN(target)){
    console.warn('Invalid target; falling back to +1h');
    target = new Date(Date.now() + 60*60*1000);
  } else {
    localStorage.setItem(lsKey, target.toISOString());
  }

  // Optional title/subtitle via URL
  const title = (qs.get('title')||'').trim();
  const subtitle = (qs.get('subtitle')||'').trim();
  if(title) $('#title').textContent = title;
  if(subtitle) $('#subtitle').textContent = subtitle;

  // Allow overriding background image paths via URL (if deploying elsewhere)
  const bg = (qs.get('bg')||'').trim();
  const bg2 = (qs.get('bg2')||'').trim();
  if(bg) $('.bg').style.backgroundImage = `url(${bg})`;
  if(bg2) $('.bg-close').style.backgroundImage = `url(${bg2})`;

  // --- Ticker
  const nodes = { d:$('#days'), h:$('#hours'), m:$('#minutes'), s:$('#seconds'), footer:$('#footer'), stage:$('#stage') };
  let zeroed = false;

  function formatRemaining(ms){
    const total = Math.max(0, Math.floor(ms/1000));
    const days = Math.floor(total / 86400);
    const hours = Math.floor((total % 86400) / 3600);
    const mins = Math.floor((total % 3600) / 60);
    const secs = total % 60;
    return {days, hours, mins, secs};
  }

  function update(){
    const now = new Date();
    const diff = target - now;
    const {days, hours, mins, secs} = formatRemaining(diff);
    nodes.d.innerHTML = pad(days);
    nodes.h.innerHTML = pad(hours);
    nodes.m.innerHTML = pad(mins);
    nodes.s.innerHTML = pad(secs);

    // Subtle heartbeat on last 10 seconds
    if(diff <= 10_000 && diff > 0){
      const beat = document.createElement('span');
      beat.className = 'pulse';
      nodes.s.innerHTML = pad(secs).replace(/.$/, m=>`<span class="pulse">${m}</span>`);
    }

    // When we cross zero once, freeze at 00 and mark .zero
    if(diff <= 0 && !zeroed){
      zeroed = true;
      nodes.stage.classList.add('zero');
      nodes.footer.textContent = 'The Council Begins';
      // Keep values at 00
      nodes.d.textContent = '00';
      nodes.h.textContent = '00';
      nodes.m.textContent = '00';
      nodes.s.textContent = '00';
      clearInterval(timer);
    }
  }

  const timer = setInterval(update, 250);
  update();

  // Expose a minimal API for quick testing in console (optional)
  window.TikiCountdown = {
    setTarget(iso){ try{ target = new Date(iso); localStorage.setItem(lsKey, target.toISOString()); update(); }catch(e){ console.error(e) } },
    getTarget(){ return target.toISOString(); }
  };
})();
</script>
</body>
</html>
